{% extends "base.html" %}

{% block title %}Contacto{% endblock %}

{% block content %}

<div class="container px-3 px-md-4 py-4">
    <h1 class="h3 text-dark text-center mb-2">Contacto</h1>
    <p class="text-center text-dark mb-4">Estamos aquí para responder a sus consultas y brindarle la información que necesita.</p>
    
    <div class="row g-3 g-md-4">
        <!-- Contact Information Card -->
        <div class="col-12 col-lg-4">
            <article class="card shadow-sm h-100 border-0" style="background-color: #f0f0f0;">
                <div class="card-body p-3 p-md-4">
                    <h2 class="h5 text-dark text-center mb-4">Información de Contacto</h2>
    
                    {% if agrupacion and agrupacion.mail %}
                    <div class="d-flex align-items-start mb-3 pb-3 border-bottom">
                        <div class="flex-shrink-0 me-3">
                            <img src="{{ url_for('static', filename='img/correo_icon.png') }}" alt="" width="48" height="48" class="img-fluid" style="object-fit: contain;" aria-hidden="true">
                        </div>
                        <div class="flex-grow-1" style="min-width: 0;">
                            <h3 class="h6 mb-1 text-dark">Correo Electrónico</h3>
                            <a href="mailto:{{ agrupacion.mail }}" class="small d-block text-break" style="color: #0066CC; word-wrap: break-word;">{{ agrupacion.mail }}</a>
                        </div>
                    </div>
                    {% endif %}
    
                    {% if telefonos %}
                    <div class="d-flex align-items-start mb-3 pb-3 border-bottom">
                        <div class="flex-shrink-0 me-3">
                            <img src="{{ url_for('static', filename='img/telefonos_icon.png') }}" alt="" width="48" height="48" class="img-fluid" style="object-fit: contain;" aria-hidden="true">
                        </div>
                        <div class="flex-grow-1" style="min-width: 0;">
                            <h3 class="h6 mb-1 text-dark">Teléfonos</h3>
                            {% for tel in telefonos %}
                                <a href="tel:{{ tel.telefono }}" class="small d-block mb-1 text-break" style="color: #0066CC; word-wrap: break-word;">{{ tel.telefono }}</a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
    
                    {% for red in redes %}
                    <div class="d-flex align-items-start mb-3">
                        <div class="flex-shrink-0 me-3">
                            {% if 'facebook' in red.nombre|lower %}
                                <img src="{{ url_for('static', filename='img/facebook_icon.png') }}" alt="" width="48" height="48" class="img-fluid" style="object-fit: contain;" aria-hidden="true">
                            {% elif 'instagram' in red.nombre|lower %}
                                <img src="{{ url_for('static', filename='img/instagram_icon.png') }}" alt="" width="48" height="48" class="img-fluid" style="object-fit: contain;" aria-hidden="true">
                            {% endif %}
                        </div>
                        <div class="flex-grow-1" style="min-width: 0;">
                            <h3 class="h6 mb-1 text-dark text-break" style="word-wrap: break-word;">{{ red.nombre }}</h3>
                            <a href="{{ red.link }}" class="small text-decoration-none text-break" style="color: #0066CC; word-wrap: break-word;" target="_blank" rel="noopener noreferrer">Visitar Perfil</a>
                        </div>
                    </div>
                    {% endfor %}
    
                </div>
            </article>
        </div>
    
        <!-- Authorities Card -->
        <div class="col-12 col-lg-4">
            <article class="card shadow-sm h-100 border-0" style="background-color: #f0f0f0;">
                <div class="card-body p-3 p-md-4">
                    <h2 class="h5 text-dark text-center mb-4">Autoridades</h2>
                    {% for rol, personas in autoridades_agrupadas.items() %}
                        <h3 class="h6 mb-2 text-dark text-break" style="word-wrap: break-word;">{{ rol }}</h3>
                        {% for persona in personas %}
                            <p class="small mb-2 ps-3 text-secondary text-break" style="word-wrap: break-word;">{{ persona }}</p>
                        {% endfor %}
                    {% endfor %}
                </div>
            </article>
        </div>
    
        <!-- Location Card -->
        <div class="col-12 col-lg-4">
            <article class="card shadow-sm h-100 border-0" style="background-color: #f0f0f0;">
                <div class="card-body p-3 p-md-4">
                    
                    {# ARMAR LA DIRECCION COMPLETA #}
                    {%- set map_query = '' -%}
                    {%- if agrupacion and agrupacion.direccion and ubicacion -%}
                        {%- set raw_parts = [
                            agrupacion.direccion,        
                            ubicacion.nombre_localidad,  
                            ubicacion.provincia          
                        ] -%}
                        {# UNIR PARTES #}
                        {%- set map_query = raw_parts | select | join(', ') -%}
                    {%- else -%}
                        {# FALLBACK DEFAULT #}
                        {%- set map_query = 'Río Cuarto, Córdoba' -%}
                    {%- endif -%}

                    <h2 class="h5 text-dark text-center mb-4">Nuestra Ubicación</h2>

                    <div class="ratio ratio-16x9 mb-3">
                        <iframe
                            src="https://maps.google.com/maps?q={{ map_query | replace(' ', '+') }}&z=15&output=embed"
                            style="border-radius: 0.5rem; border: 0;"
                            allowfullscreen=""
                            loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"
                            title="Mapa de ubicación de la agrupación">
                        </iframe>
                    </div>

                    {%- if map_query -%}
                        <p class="small text-center mb-2 text-secondary">{{ map_query }}.</p>
                    {%- elif ubicacion -%}
                        <p class="small text-center mb-0 text-secondary">{{ ubicacion.nombre_localidad }}, {{ ubicacion.provincia }}.</p>
                    {%- endif %}
                </div>
            </article>
        </div>
    </div>
</div>
{% endblock %}
