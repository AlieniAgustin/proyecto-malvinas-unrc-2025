{% extends 'base_admin.html' %}

{% block title %}Modificar Persona{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modificar_veterano.css') }}">
{% endblock %}

{% block content %}

<div class="container-fluid px-3">
    <h1 class="h2 mb-3">Modificar Persona</h1>
    <p class="text-muted">Actualice el formulario con los datos del veterano (los campos con * son obligatorios).</p>
    <hr class="my-4">
        <form class="formulario" method="POST" action="{{ url_for('main.modificar_persona_guardar', dni=veterano.dni) }}">
        <section>
            <h3 class="h4">Información personal</h3>
            <div class="grid">
                <div>
                    <label>DNI*</label>
                    <input type="text" name="dni" value="{{ veterano.dni }}" disabled>
                </div>
                <div>
                    <label>Nombre*</label>
                    <input type="text" name="nombre" value="{{ veterano.nombre or '' }}" required>
                </div>
                <div>
                    <label>Apellido*</label>
                    <input type="text" name="apellido" value="{{ veterano.apellido or '' }}" required>
                </div>
                <div>
                    <label>Género</label>
                    <select name="genero">
                        <option value="no especificado" {% if veterano.genero == 'no especificado' %}selected{% endif %}>No especificado</option>
                        <option value="masculino" {% if veterano.genero == 'masculino' %}selected{% endif %}>Masculino</option>
                        <option value="femenino" {% if veterano.genero == 'femenino' %}selected{% endif %}>Femenino</option>
                        <option value="otro" {% if veterano.genero == 'otro' %}selected{% endif %}>Otro</option>
                    </select>
                </div>
                <div>
                    <label>Fecha de nacimiento*</label>
                    <input type="date" name="fecha_nacimiento" id="fecha_nacimiento" value="{{ veterano.fecha_nacimiento.strftime('%Y-%m-%d') if veterano.fecha_nacimiento else '' }}" required>
                </div>
                <div>
                    <label>Edad</label>
                    <input type="text" id="edad" disabled placeholder="Calculado automáticamente">
                </div>
                <div>
                    <label>Provincia de nacimiento</label>
                    <select name="provincia_nacimiento" id="provincia_nacimiento">
                        <option value="">Seleccione una provincia</option>
                        {% for provincia in provincias %}
                        <option value="{{ provincia.id_provincia }}" {% if veterano.provincia_nacimiento == provincia.id_provincia %}selected{% endif %}>{{ provincia.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Localidad de nacimiento</label>
                    <select name="localidad_nacimiento" id="localidad_nacimiento" disabled>
                        <option value="">Seleccione una localidad</option>
                    </select>
                </div>
            </div>
        </section>

        <section>
            <h3 class="h4">Información de contacto</h3>
            <div class="grid">
                <div>
                    <label>Provincia de residencia</label>
                    <select name="provincia_residencia" id="provincia_residencia">
                        <option value="">Seleccione una provincia</option>
                        {% for provincia in provincias %}
                        <option value="{{ provincia.id_provincia }}" {% if veterano.provincia_residencia == provincia.id_provincia %}selected{% endif %}>{{ provincia.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Localidad de residencia</label>
                    <select name="localidad_residencia" id="localidad_residencia" disabled>
                        <option value="">Seleccione una localidad</option>
                    </select>
                </div>
                <div>
                    <label>Dirección postal</label>
                    <input type="text" name="direccion" value="{{ veterano.direccion or '' }}" placeholder="Ej: Av. Sabattini 2750">
                </div>
                <div>
                    <label>Código postal</label>
                    <select name="codigo_postal_residencia" id="codigo_postal" disabled>
                        <option value="">Seleccione un código postal</option>
                    </select>
                    <input type="text" id="otro_codigo_postal" name="otro_codigo_postal" 
                        style="display:none; margin-top:5px;" 
                        placeholder="Ingrese código postal">
                </div>
                <div>
                    <label>Correo electrónico</label>
                    <input type="email" name="mail" value="{{ veterano.mail or '' }}" placeholder="Ej: ejemplo@mail.com">
                </div>
                <div>
                    <label>Teléfono</label>
                    <input type="tel" name="telefono" value="{{ telefono.telefono or '' }}" placeholder="Ej: 0358-1234567">
                </div>
            </div>
        </section>

        <section>
            <h3 class="h4">Información militar</h3>
            <div class="grid">
                <div>
                    <label>Fuerza*</label>
                    <select name="fuerza" id="fuerza" required>
                        <option value="">Seleccione una fuerza</option>
                        {% for fuerza in fuerzas %}
                        <option value="{{ fuerza.id_fuerza }}" {% if veterano.id_fuerza == fuerza.id_fuerza %}selected{% endif %}>{{ fuerza.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Grado</label>
                    <select name="grado" id="grado" disabled>
                        <option value="">Seleccione un grado</option>
                        <option value="otro">Otro</option>
                    </select>
                    <input type="text" id="otro_grado" name="otro_grado" style="display: none; margin-top: 5px;" placeholder="Ingrese el grado">
                </div>
                <div>
                    <label>Función</label>
                    <input type="text" name="funcion" value="{{ veterano.funcion or '' }}" placeholder="Ej: Soldado de infantería">
                </div>
                <div>
                    <label>Secuelas</label>
                    <input type="text" name="secuelas" value="{{ veterano.secuelas or '' }}" placeholder="Ej: Pérdida auditiva parcial">
                </div>
                <div>
                    <label>Número de Beneficio Nacional</label>
                    <input type="text" name="nro_beneficio_nacional" value="{{ veterano.nro_beneficio_nacional or '' }}" placeholder="Ej: 12345">
                </div>
            </div>
        </section>

        <section>
            <h3 class="h4">Estado</h3>
            <div class="grid">
                <div class="estado">
                    <label>Estado de vida*:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="estado_vida" id="vivo" value="vivo" {% if not veterano.es_fallecido %}checked{% endif %}> Vive
                        </label>
                        <label>
                            <input type="radio" name="estado_vida" id="fallecido" value="fallecido" {% if veterano.es_fallecido %}checked{% endif %}> Fallecido
                        </label>
                    </div>
                </div>
                    <div class="estado" id="fecha_fallecido" style="{% if not veterano.es_fallecido %}display: none;{% endif %}">
                    <label>Fecha de fallecimiento</label> 
                    <input type="date" id="fecha_fallecimiento" name="fecha_fallecimiento" value="{{ veterano.fecha_fallecimiento.strftime('%Y-%m-%d') if veterano.fecha_fallecimiento else '' }}">
                    <small class="text-danger d-none" id="error_fecha_fallecimiento"></small>
                </div>
                <div id="causa_fallecido" class="estado" style="{% if not veterano.es_fallecido %}display: none;{% endif %}">
                    <label>Causa de fallecimiento</label>
                    <select name="causa_fallecimiento" id="causa_fallecimiento">
                        <option value="">Seleccione una causa</option>
                        {% for causa in causas %} 
                        <option value="{{ causa.id_causa }}" {% if veterano.id_causa == causa.id_causa %}selected{% endif %}>{{ causa.descripcion }}</option>
                        {% endfor %}
                    </select>
                    <small class="text-danger d-none" id="error_causa_fallecimiento"></small>
                </div>
            </div>
        </section>

        <div class="acciones">
            <button type="button" class="cancelar" onclick="window.location.href='{{ url_for('main.modificar_datos') }}'">Cancelar</button>
            <button type="submit" class="guardar">Guardar Cambios</button>
        </div>
    </form>
</div>

<script>
    // Inyecta los datos necesarios para el script externo
    window.APP_DATA = {
        grados: {{ grados | tojson | safe }},
        veterano: {
            provinciaNacimiento: {{ veterano.provincia_nacimiento or 'null' }},
            departamentoNacimiento: {{ veterano.departamento_nacimiento | tojson | safe }},
            localidadNacimiento: {{ veterano.localidad_nacimiento or 'null' }},
            provinciaResidencia: {{ veterano.provincia_residencia or 'null' }},
            departamentoResidencia: {{ veterano.departamento_residencia | tojson | safe }},
            localidadResidencia: {{ veterano.localidad_residencia or 'null' }},
            idFuerza: {{ veterano.id_fuerza or 'null' }},
            idGrado: {{ veterano.id_grado or 'null' }},
            codigoPostal: {{ veterano.codigo_postal_residencia | tojson | safe }}
        }
    };
</script>
<script src="{{ url_for('static', filename='js/form_veterano.js') }}"></script>

{% endblock %}
